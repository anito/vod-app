<script>
  import { users } from '../../stores/userStore';
  import Chip, { Icon, Text } from '@smui/chips';

  export let selectionUserId;

  const dateOptions = {
    day: '2-digit',
    year: 'numeric',
    month: '2-digit',
    hour: 'numeric',
    minute: 'numeric',
  };

  let expirationDate;
  let expires;
  let isExpired;
  let expiresChipLabel;
  let chipIcon;

  $: currentUser = ((id) => $users.filter((usr) => usr.id === id))(selectionUserId)[0];
  $: ((user) => {
    expires = user && user.expires;
    isExpired = (expires && expires * 1000 < +new Date().getTime()) || false;
    expirationDate = (expires && new Date(parseInt(expires) * 1000).toLocaleDateString('de-DE', dateOptions)) || void 0;
    expiresChipLabel =
      (expirationDate && `Token ${isExpired ? 'verfallen' : 'verfÃ¤llt'} am ${expirationDate}`) ||
      'keine Tokeninformation vorhanden';
    chipIcon = (expirationDate && (isExpired ? 'hourglass_empty' : 'hourglass_full')) || 'hourglass_disabled';
  })(currentUser);
</script>

<span class="chip-items">
  <Chip class="transparent">
    <Icon class="material-icons" leading>{chipIcon}</Icon>
    <Text>{expiresChipLabel}</Text>
  </Chip>
</span>
