<script>
  import * as api from 'api';
  import { onMount, getContext } from 'svelte';
  import Menu, { SelectionGroup, SelectionGroupIcon } from '@smui/menu';
  import { Anchor } from '@smui/menu-surface';
  import List, { Item, Text } from '@smui/list';
  import { _, locale, locales } from 'svelte-i18n';

  const { getSnackbar, configSnackbar } = getContext('snackbar');

  let snackbar;
  let localeMenu;
  let localeMenuAnchor;
  let currentLocale;

  locale.subscribe((cur) => (currentLocale = cur.replace(/-[\w-\d]+/, '')));

  onMount(() => {
    snackbar = getSnackbar();
  });

  async function setLocale(value) {
    locale.set(value);
  }
</script>

<div class="choose-locale" on:click={() => localeMenu.setOpen(true)}>
  <div class="menu-anchor" bind:this={localeMenuAnchor} use:Anchor>
    <div class="current-locale font-bold">{currentLocale.toUpperCase()}</div>
    <Menu bind:this={localeMenu} bind:anchorElement={localeMenuAnchor} anchor={false} anchorCorner="TOP_END">
      <List>
        {#each $locales as _locale}
          <Item on:click={() => setLocale(_locale)}>
            <Text class={_locale === currentLocale && 'font-bold'}>{_locale.toUpperCase()}</Text>
          </Item>
        {/each}
      </List>
    </Menu>
  </div>
</div>

<style></style>
