<script>
  import { stores } from '@sapper/app';
  import { ticker } from '../../stores/tickerStore';
  import { _ } from 'svelte-i18n';

  const { session } = stores();

  Number.prototype.minDigits = function (m, locale = 'de-DE', options) {
    return this.toLocaleString(locale, {
      minimumIntegerDigits: m,
      ...options,
    });
  };

  function parse(ms) {
    if (isNaN(ms)) return '--:--:--';
    let tt, hrs, min, sec;
    tt = ms / 1000;
    sec = Math.floor(tt % 60).minDigits(2);
    min = Math.floor((tt / 60) % 60).minDigits(2);
    hrs = Math.floor(tt / 3600).minDigits(2);
    return `${hrs}:${min}:${sec}`;
  }
</script>

{#if $session.user}
  <div class="ticker">
    <span>{$_('text.session-expires')}</span>
    <span class="timer">
      {parse($ticker)}
    </span>
  </div>
{/if}

<style>
  .ticker {
    margin: 0 10px;
  }
</style>
