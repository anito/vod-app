<script>
  import './chip.scss';
  import { stores } from '@sapper/app';
  import { proxyEvent } from '../utils';
  import { infos } from '../../stores/infoStore';
  import Chip, { Set, Icon, Text } from '@smui/chips';

  export let selectionUserId;
  export { className as class };
  export let staggered = false;

  const defaultIcon = 'circle_notifications';

  let className = '';

  $: chips = ($infos.has(selectionUserId) && $infos.get(selectionUserId).params) || [];
  $: promise = Promise.resolve(chips);

  function getIcon(flag) {
    let icon;
    switch (flag) {
      case 'info':
        icon = 'info';
        break;
      case 'warning':
        icon = 'error';
        break;
      default:
        icon = defaultIcon;
    }
    return icon;
  }
</script>

{#await promise then chips}
  {#if chips.length}
    <div class:staggered>
      <Set class="{className}}" {chips} key={(chip) => Math.floor(Math.random() * 1e6 + 1)} let:chip>
        <Chip
          id={chip.id}
          class={chip.flag}
          on:MDCChip:interaction={(e) => proxyEvent(e, { ...chip, userId: selectionUserId })}
          on:MDCChip:interaction
        >
          <Icon class="material-icons" leading>{getIcon(chip.flag)}</Icon>
          <Text>{chip.label}</Text>
        </Chip>
      </Set>
    </div>
  {:else}
    <div class="empty">
      <div class="">Keine Mitteilungen</div>
    </div>
  {/if}
{/await}

<style>
  .staggered :global(.mdc-chip-set > #account-inaccessible) {
    padding-right: 30px;
  }
  .staggered :global(.mdc-chip-set > #account-inaccessible ~ .mdc-chip) {
    margin-left: -30px;
  }
  .staggered :global(.mdc-chip-set > #account-inaccessible ~ .mdc-chip:not(:last-child)) {
    padding-right: 30px;
  }
  .staggered :global(.mdc-chip-set > #account-inaccessible ~ .mdc-chip) {
    box-shadow: 0 0 1px rgb(0 0 0 / 68%);
  }
</style>
